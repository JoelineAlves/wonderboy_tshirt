<script type="text/javascript">
$(document).ready(function () {
    "use strict";

    let isProductPage = $("body").hasClass("product-page");
    let isCartPage = $("body").hasClass("cart-page");

    function handleEnableDisable(itemId, size) {
        let qtyInput = $(`#id_qty_${itemId}_${size}`);
        if (!qtyInput.length) return;

        let currentValue = parseInt(qtyInput.val(), 10);
        let minusDisabled = currentValue < 2;
        let plusDisabled = currentValue > 98;

        $(`#decrement-qty_${itemId}_${size}`).prop("disabled", minusDisabled);
        $(`#increment-qty_${itemId}_${size}`).prop("disabled", plusDisabled);

        if (isCartPage) {
            updateSubtotal(itemId, size);
        }
    }

    function updateSubtotal(itemId, size) {
        let qtyInput = $(`#id_qty_${itemId}_${size}`);
        if (!qtyInput.length) return;

        let currentValue = parseInt(qtyInput.val(), 10);
        let priceElement = $(`#price_${itemId}`);

        if (!priceElement.length) return;

        let price = parseFloat(priceElement.data("price"));

        if (!isNaN(price) && !isNaN(currentValue)) {
            let subtotal = currentValue * price;
            $(`#subtotal_${itemId}_${size}`).text(`$${subtotal.toFixed(2)}`);
        }
    }

    $(".qty_input").each(function () {
        let itemId = $(this).data("item_id");
        let size = $(this).data("size");
        handleEnableDisable(itemId, size);
    });

    $(".qty_input").change(function () {
        let itemId = $(this).data("item_id");
        let size = $(this).data("size");
        handleEnableDisable(itemId, size);

        if (isCartPage) {
            $(this).closest("form").trigger("submit");
        }
    });

    $(".increment-qty, .decrement-qty").click(function (e) {
        e.preventDefault();

        let closestInput = $(this).closest(".input-group").find(".qty_input");
        if (!closestInput.length) return;

        let currentValue = parseInt(closestInput.val(), 10);
        let isIncrement = $(this).hasClass("increment-qty");

        let newValue = isIncrement ? currentValue + 1 : currentValue - 1;
        closestInput.val(newValue);

        let itemId = $(this).data("item_id");
        let size = $(this).data("size");

        handleEnableDisable(itemId, size);

        let form = $(this).closest("form");
        if (form.length) {
            form.trigger("submit");
        }
    });

    if (isCartPage) {
        $(".increment-qty, .decrement-qty").hide();
    }
});
</script>

























