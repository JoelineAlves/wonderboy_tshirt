<script type="text/javascript">

    // Função para habilitar/desabilitar botões com base no valor da quantidade
    function handleEnableDisable(itemId, size) {
        var currentValue = parseInt($(`#id_qty_${itemId}_${size}`).val());
        var minusDisabled = currentValue < 2;
        var plusDisabled = currentValue > 98;
        $(`#decrement-qty_${itemId}_${size}`).prop('disabled', minusDisabled);
        $(`#increment-qty_${itemId}_${size}`).prop('disabled', plusDisabled);
    }

    // Função para atualizar o subtotal e o total do carrinho
    function updateSubtotal(itemId, size, price) {
        var quantity = parseInt($(`#id_qty_${itemId}_${size}`).val());
        var newSubtotal = (quantity * price).toFixed(2); // Calcula o subtotal
        $(`#subtotal_${itemId}_${size}`).text(`$${newSubtotal}`); // Atualiza o subtotal no HTML
    }

    // Quando a quantidade for alterada, enviar uma requisição AJAX para atualizar o bag
    $('.qty_input').change(function() {
        var itemId = $(this).data('item_id');
        var size = $(this).data('size');
        var price = parseFloat($(this).data('price')); // Obtém o preço do produto
        var quantity = parseInt($(this).val());
        var csrfToken = "{{ csrf_token }}";
        
        var url = `/bag/adjust/${itemId}/`; // URL da view adjust_bag
        var data = {
            'csrfmiddlewaretoken': csrfToken,
            'quantity': quantity,
            'product_size': size
        };

        $.post(url, data)
         .done(function(response) {
             if (response.removed) {
                 location.reload(); // Recarrega se o item foi removido
             } else {
                 updateSubtotal(itemId, size, price); // Atualiza o subtotal no front-end
             }
         })
         .fail(function() {
             location.reload(); // Recarrega a página se houver erro
         });
    });

    // Incrementar quantidade e atualizar subtotal
    $('.increment-qty').click(function(e) {
        e.preventDefault();
        var closestInput = $(this).closest('.input-group').find('.qty_input');
        var currentValue = parseInt(closestInput.val());
        closestInput.val(currentValue + 1).change(); // Dispara o evento change
    });

    // Decrementar quantidade e atualizar subtotal
    $('.decrement-qty').click(function(e) {
        e.preventDefault();
        var closestInput = $(this).closest('.input-group').find('.qty_input');
        var currentValue = parseInt(closestInput.val());
        closestInput.val(currentValue - 1).change(); // Dispara o evento change
    });

</script>

